name: Build and Deploy to CloudFront
on:
    push:
        branches: [master]

jobs:
    build-and-deploy:
        name: Build and Deploy
        runs-on: ubuntu-latest
    env:
        BUCKET: aswindev.in
        DIST: build
        REGION: ap-south-1
        DIST_ID: E3VCVOBBHMQ8C2
    
    steps:
        - name: Checkout
        uses: actions/checkout@v2 

        - name: Configure aws Credentials
        uses: actions/configure-aws-credentials@v1
        with:
            aws-access-key-id: ${{secrets.AWS_ACCESS_KEY_ID}}
            aws-secret-access-key-id: ${{secrets.AWS_SECRET_ACCESS_KEY_ID}}\
            aws-region: ${{env.REGION}}

        - name: Install Dependencies
        run: |
            node --version
            npm ci --production

        - name: Build Static Website
        run: npm run build

        - name: Copy files to production website
        run: |
            aws s3 sync --delete ${{env.DIST}} s3://${{env.BUCKET}}

        - name: Copy file to production website
        run: |
            aws cloudfront create-invalidation \
            --distribution-id ${{env.DIST_ID}}
            --paths "/*"




